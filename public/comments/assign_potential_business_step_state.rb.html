<!DOCTYPE html>
<html lang="en-GB">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">
    <link rel="alternate" type="text/markdown" href="assign_potential_business_step_state.rb.md">
    <style>
      body {
        max-width: 40rem;
        margin: auto;
        padding: 2rem 1rem;
        font-family: 'Helvetica Neue','Helvetica', system-ui;
        color: black;
        background-color: white;
      }
      p {line-height: 1.4;}
      code {
      line-height: 1.4;
      color:gray;
      }
      code pre {white-space: pre-wrap; word-break: break-word;}
      code:hover {color:black;}
      h1, h2 {font-weight:normal;}
      a {text-decoration:none;}
      a.githubline {color:gray;font-weight:bold;}
      @media (prefers-color-scheme: dark) {
body {color:white;background-color:black;}
a {text-decoration:underline;color:white;}
}
    </style>
    <title>lib/parsing/assign_potential_business_step_state.rb</title>
  </head>
  <body><p><a href="/procedures/meta/comments">/procedures/meta/comments</a></p><h1>Module to assign a potential state to a business step.</h1>
<code title='Line 2, lib/parsing/assign_potential_business_step_state.rb'><pre><a name='2'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/assign_potential_business_step_state.rb#L2'> 2</a> module PARSE_ASSIGN_POTENTIAL_BUSINESS_STEP_STATE
</pre></code><h2>Method to assign a <a href="https://ukparliament.github.io/ontologies/procedure/maps/meta/design-notes/#potential-states-of-a-business-step">potential state</a> to a business step, being the target of a successfully parsed route.</h2>
<code title='Line 5, lib/parsing/assign_potential_business_step_state.rb'><pre><a name='5'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/assign_potential_business_step_state.rb#L5'> 5</a>   def assign_potential_business_step_state( route_id )
</pre></code><p>If the route we&#39;re attempting to parse has been successfully parsed ...</p>
<code title='Line 8, lib/parsing/assign_potential_business_step_state.rb'><pre><a name='8'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/assign_potential_business_step_state.rb#L8'> 8</a>     if route_parsed_attribute( route_id ) == true
</pre></code><p>... we write to the parse log, reporting the route&#39;s parsed status.</p>
<code title='Line 11, lib/parsing/assign_potential_business_step_state.rb'><pre><a name='11'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/assign_potential_business_step_state.rb#L11'> 11</a>       @parse_log << "Successfully parsed as <strong>#{route_status_attribute( route_id )}</strong>."
</pre></code><p>... if the target step of the route we&#39;ve parsed is a business step ...</p>
<code title='Line 14, lib/parsing/assign_potential_business_step_state.rb'><pre><a name='14'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/assign_potential_business_step_state.rb#L14'> 14</a>       if route_target_step_type( route_id ) == 'Business step'
</pre></code><h3>We check the status of the route we&#39;ve parsed.</h3>
<code title='Line 17, lib/parsing/assign_potential_business_step_state.rb'><pre><a name='17'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/assign_potential_business_step_state.rb#L17'> 17</a>         case route_status_attribute( route_id )
</pre></code><p>When the status of the route we&#39;ve parsed is &#39;TRUE&#39; ...</p>
<code title='Line 20, lib/parsing/assign_potential_business_step_state.rb'><pre><a name='20'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/assign_potential_business_step_state.rb#L20'> 20</a>         when "TRUE"
</pre></code><p>... we don&#39;t want steps that are scheduled to happen to be also listed as steps that are caused to happen, so ...</p>
<p>... unless the target step of the route has been actualised by at least one business item, regardless of the date of those business items ...</p>
<code title='Line 24, lib/parsing/assign_potential_business_step_state.rb'><pre><a name='24'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/assign_potential_business_step_state.rb#L24'> 24</a>           unless route_target_step_is_actualised?( route_id )
</pre></code><p>... we add the target step to the array of caused steps.</p>
<code title='Line 27, lib/parsing/assign_potential_business_step_state.rb'><pre><a name='27'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/assign_potential_business_step_state.rb#L27'> 27</a>             @caused_steps << route_target_step( route_id )
</pre></code><code title='Line 28, lib/parsing/assign_potential_business_step_state.rb'><pre><a name='28'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/assign_potential_business_step_state.rb#L28'> 28</a>           end
</pre></code><p>When the status of the route we&#39;ve parsed is &#39;ALLOWS&#39; ...</p>
<code title='Line 31, lib/parsing/assign_potential_business_step_state.rb'><pre><a name='31'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/assign_potential_business_step_state.rb#L31'> 31</a>         when "ALLOWS"
</pre></code><p>... we add the target step to the array of allowed steps.</p>
<code title='Line 34, lib/parsing/assign_potential_business_step_state.rb'><pre><a name='34'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/assign_potential_business_step_state.rb#L34'> 34</a>           @allowed_steps << route_target_step( route_id )
</pre></code><p>When the status of the route we&#39;ve parsed is &#39;FALSE&#39; ...</p>
<code title='Line 37, lib/parsing/assign_potential_business_step_state.rb'><pre><a name='37'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/assign_potential_business_step_state.rb#L37'> 37</a>         when "FALSE"
</pre></code><p>... we add the target step to the array of disallowed as yet steps.</p>
<code title='Line 40, lib/parsing/assign_potential_business_step_state.rb'><pre><a name='40'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/assign_potential_business_step_state.rb#L40'> 40</a>           @disallowed_as_yet_steps << route_target_step( route_id )
</pre></code><p>When the status of the route we&#39;ve parsed is &#39;UNTRAVERSABLE&#39; ...</p>
<code title='Line 43, lib/parsing/assign_potential_business_step_state.rb'><pre><a name='43'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/assign_potential_business_step_state.rb#L43'> 43</a>         when "UNTRAVERSABLE"
</pre></code><p>... we add the target step to the array of disallowed now steps.</p>
<code title='Line 46, lib/parsing/assign_potential_business_step_state.rb'><pre><a name='46'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/assign_potential_business_step_state.rb#L46'> 46</a>           @disallowed_now_steps << route_target_step( route_id )
</pre></code><p>Otherwise, if the status of the route we&#39;ve parsed is neither &#39;TRUE&#39;, &#39;ALLOWS&#39;, &#39;FALSE&#39; or &#39;UNTRAVERSABLE&#39; ...</p>
<code title='Line 49, lib/parsing/assign_potential_business_step_state.rb'><pre><a name='49'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/assign_potential_business_step_state.rb#L49'> 49</a>         else
</pre></code><p>... we write to the parse log, reporting that the successfully parsed route has an unexpected status.</p>
<code title='Line 52, lib/parsing/assign_potential_business_step_state.rb'><pre><a name='52'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/assign_potential_business_step_state.rb#L52'> 52</a>           @parse_log << "Unexpected status of <strong>#{route_status_attribute( route_id )}</strong>."
</pre></code><code title='Line 53, lib/parsing/assign_potential_business_step_state.rb'><pre><a name='53'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/assign_potential_business_step_state.rb#L53'> 53</a>         end
</pre></code><code title='Line 54, lib/parsing/assign_potential_business_step_state.rb'><pre><a name='54'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/assign_potential_business_step_state.rb#L54'> 54</a>       end
</pre></code><code title='Line 55, lib/parsing/assign_potential_business_step_state.rb'><pre><a name='55'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/assign_potential_business_step_state.rb#L55'> 55</a>     end
</pre></code><code title='Line 56, lib/parsing/assign_potential_business_step_state.rb'><pre><a name='56'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/assign_potential_business_step_state.rb#L56'> 56</a>   end
</pre></code><code title='Line 57, lib/parsing/assign_potential_business_step_state.rb'><pre><a name='57'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/assign_potential_business_step_state.rb#L57'> 57</a> end</pre></code></body></html>