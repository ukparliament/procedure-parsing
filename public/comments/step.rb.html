<!DOCTYPE html>
<html lang="en-GB">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">
    <link rel="alternate" type="text/markdown" href="step.rb.md">
    <style>
      body {
        max-width: 40rem;
        margin: auto;
        padding: 2rem 1rem;
        font-family: 'Helvetica Neue','Helvetica', system-ui;
        color: black;
        background-color: white;
      }
      p {line-height: 1.4;}
      code {
      line-height: 1.4;
      color:gray;
      }
      code pre {white-space: pre-wrap; word-break: break-word;}
      code:hover {color:black;}
      h1, h2 {font-weight:normal;}
      a {text-decoration:none;}
      a.githubline {color:gray;font-weight:bold;}
      @media (prefers-color-scheme: dark) {
body {color:white;background-color:black;}
a {text-decoration:underline;color:white;}
}
    </style>
    <title>app/models/step.rb</title>
  </head>
  <body><p><a href="/procedures/meta/comments">/procedures/meta/comments</a></p><h1>Step model.</h1>
<p>A step may be attached to routes in one or more procedures.</p>
<p>A step has one or more inbound routes.</p>
<p>A step has one or more outbound routes, or none. </p>
<p>Within a procedure, the <a href="https://ukparliament.github.io/ontologies/procedure/flowcharts/meta/design-notes/#validating-inputs-and-outputs-to-steps">expected numbers of inbound and outbound routes depend on the type of the step</a>.</p>
<p>A step belongs to one House, both Houses or neither.</p>
<code title='Line 7, app/models/step.rb'><pre><a name='7'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/app/models/step.rb#L7'> 7</a> class Step < ActiveRecord::Base
</pre></code><h2>Method to return an array of IDs of routes from a step.</h2>
<p>We call the method passing the hash of outbound routes from a step.</p>
<code title='Line 11, app/models/step.rb'><pre><a name='11'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/app/models/step.rb#L11'> 11</a>   def outbound_route_ids( routes_from_steps )
</pre></code><p>We get an array of IDs of routes from the step with this ID.</p>
<code title='Line 14, app/models/step.rb'><pre><a name='14'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/app/models/step.rb#L14'> 14</a>     routes_from_steps[self.id]
</pre></code><code title='Line 15, app/models/step.rb'><pre><a name='15'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/app/models/step.rb#L15'> 15</a>   end
</pre></code><h2>A method to select house steps - the join between steps and Houses - for a step taking place in the House of Commons.</h2>
<p>This method evaluates as true if this step takes place in the House of Commons.</p>
<code title='Line 19, app/models/step.rb'><pre><a name='19'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/app/models/step.rb#L19'> 19</a>   def in_commons?
</pre></code><code title='Line 20, app/models/step.rb'><pre><a name='20'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/app/models/step.rb#L20'> 20</a>     HouseStep.all.select( 'hs.*' ).joins( 'as hs, houses as h' ).where( 'hs.step_id = ?', self ).where( 'hs.house_id = h.id').where( 'h.name =?', 'House of Commons' ).order( 'hs.id' ).first
</pre></code><code title='Line 21, app/models/step.rb'><pre><a name='21'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/app/models/step.rb#L21'> 21</a>   end
</pre></code><h2>A method to select house steps - the join between steps and Houses - for a step taking place in the House of Lords.</h2>
<p>This method evaluates as true if this step takes place in the House of Lords.</p>
<code title='Line 25, app/models/step.rb'><pre><a name='25'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/app/models/step.rb#L25'> 25</a>   def in_lords?
</pre></code><code title='Line 26, app/models/step.rb'><pre><a name='26'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/app/models/step.rb#L26'> 26</a>     HouseStep.all.select( 'hs.*' ).joins( 'as hs, houses as h' ).where( 'hs.step_id = ?', self ).where( 'hs.house_id = h.id').where( 'h.name =?', 'House of Lords' ).order( 'hs.id' ).first
</pre></code><code title='Line 27, app/models/step.rb'><pre><a name='27'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/app/models/step.rb#L27'> 27</a>   end
</pre></code><h2>A method to construct a House label for a step.</h2>
<code title='Line 30, app/models/step.rb'><pre><a name='30'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/app/models/step.rb#L30'> 30</a>   def house_label
</pre></code><code title='Line 31, app/models/step.rb'><pre><a name='31'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/app/models/step.rb#L31'> 31</a>     house_label = ''
</pre></code><p>If the step takes place in both Houses ...</p>
<code title='Line 34, app/models/step.rb'><pre><a name='34'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/app/models/step.rb#L34'> 34</a>     if self.in_commons? and self.in_lords?
</pre></code><p>... we set the label to say both Houses. </p>
<code title='Line 37, app/models/step.rb'><pre><a name='37'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/app/models/step.rb#L37'> 37</a>       house_label = 'House of Commons and House of Lords'
</pre></code><p>Otherwise, if the step only takes place in the House of Commons ...</p>
<code title='Line 40, app/models/step.rb'><pre><a name='40'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/app/models/step.rb#L40'> 40</a>     elsif self.in_commons?
</pre></code><p>... we set the label to say House of Commons.</p>
<code title='Line 43, app/models/step.rb'><pre><a name='43'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/app/models/step.rb#L43'> 43</a>       house_label = 'House of Commons'
</pre></code><p>Otherwise, if the step only takes place in the House of Lords ...</p>
<code title='Line 46, app/models/step.rb'><pre><a name='46'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/app/models/step.rb#L46'> 46</a>     elsif self.in_lords?
</pre></code><p>... we set the label to say House of Lords.</p>
<code title='Line 49, app/models/step.rb'><pre><a name='49'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/app/models/step.rb#L49'> 49</a>       house_label = 'House of Lords'
</pre></code><p>Otherwise, the step must take place in neither House ...</p>
<code title='Line 52, app/models/step.rb'><pre><a name='52'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/app/models/step.rb#L52'> 52</a>     else
</pre></code><p>... so we set the label appropriately.</p>
<code title='Line 55, app/models/step.rb'><pre><a name='55'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/app/models/step.rb#L55'> 55</a>       house_label = 'Neither House'
</pre></code><code title='Line 56, app/models/step.rb'><pre><a name='56'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/app/models/step.rb#L56'> 56</a>     end
</pre></code><p>We return the house label.</p>
<code title='Line 59, app/models/step.rb'><pre><a name='59'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/app/models/step.rb#L59'> 59</a>     house_label
</pre></code><code title='Line 60, app/models/step.rb'><pre><a name='60'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/app/models/step.rb#L60'> 60</a>   end
</pre></code><code title='Line 61, app/models/step.rb'><pre><a name='61'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/app/models/step.rb#L61'> 61</a> end</pre></code></body></html>