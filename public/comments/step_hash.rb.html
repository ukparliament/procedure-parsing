<!DOCTYPE html>
<html lang="en-GB">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">
    <link rel="alternate" type="text/markdown" href="step_hash.rb.md">
    <style>
      body {
        max-width: 40rem;
        margin: auto;
        padding: 2rem 1rem;
        font-family: 'Helvetica Neue','Helvetica', system-ui;
        color: black;
        background-color: white;
      }
      p {line-height: 1.4;}
      code {
      line-height: 1.4;
      color:gray;
      }
      code pre {white-space: pre-wrap; word-break: break-word;}
      code:hover {color:black;}
      h1, h2 {font-weight:normal;}
      a {text-decoration:none;}
      a.githubline {color:gray;font-weight:bold;}
      @media (prefers-color-scheme: dark) {
body {color:white;background-color:black;}
a {text-decoration:underline;color:white;}
}
    </style>
    <title>lib/parsing/step_hash.rb</title>
  </head>
  <body><p><a href="/procedures/meta/comments">/procedures/meta/comments</a></p><h1>Module to initialise a hash of steps keyed off the step ID together with a hash of IDs of outbound routes from a step and a hash of IDs of inbound routes to a step, also keyed off the step ID.</h1>
<code title='Line 2, lib/parsing/step_hash.rb'><pre><a name='2'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/step_hash.rb#L2'> 2</a> module PARSE_STEP_HASH
</pre></code><h2>Method to initialise a hash of steps keyed off the step ID together with a hash of IDs of outbound routes from a step and a hash of IDs of inbound routes to a step, also keyed off the step ID.</h2>
<code title='Line 5, lib/parsing/step_hash.rb'><pre><a name='5'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/step_hash.rb#L5'> 5</a>   def initialise_step_hashes( procedure )
</pre></code><p>We create three hashes: a hash to store all steps objects in a procedure, keyed off the step ID ...</p>
<code title='Line 8, lib/parsing/step_hash.rb'><pre><a name='8'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/step_hash.rb#L8'> 8</a>     @steps = {}
</pre></code><p>... a hash of IDs of outbound routes from each individual step, keyed off the step ID ...</p>
<code title='Line 11, lib/parsing/step_hash.rb'><pre><a name='11'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/step_hash.rb#L11'> 11</a>     @routes_from_steps = {}
</pre></code><p>... and a hash of IDs of inbound routes to each individual step, keyed off the step ID.</p>
<code title='Line 14, lib/parsing/step_hash.rb'><pre><a name='14'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/step_hash.rb#L14'> 14</a>     @routes_to_steps = {}
</pre></code><p>We get all steps attached to routes in the procedure.</p>
<p>We include a count of actualisations of business items in the work package having happened in the past or today.</p>
<code title='Line 18, lib/parsing/step_hash.rb'><pre><a name='18'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/step_hash.rb#L18'> 18</a>     steps = procedure.steps_with_actualisations_in_work_package( @work_package )
</pre></code><p>For each step in the procedure ...</p>
<code title='Line 21, lib/parsing/step_hash.rb'><pre><a name='21'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/step_hash.rb#L21'> 21</a>     steps.each do |step|
</pre></code><p>... we create an array to store the IDs of routes outbound from this step</p>
<code title='Line 24, lib/parsing/step_hash.rb'><pre><a name='24'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/step_hash.rb#L24'> 24</a>       from_route_array = []
</pre></code><p>... and an array to store the IDs of routes inbound to this step.</p>
<code title='Line 27, lib/parsing/step_hash.rb'><pre><a name='27'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/step_hash.rb#L27'> 27</a>       to_route_array = []
</pre></code><p>For each route in the procedure ...</p>
<code title='Line 30, lib/parsing/step_hash.rb'><pre><a name='30'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/step_hash.rb#L30'> 30</a>     	@routes.each do |route|
</pre></code><p>... we add the ID of the route to the array of outbound IDs, if the route is outbound from this step ...</p>
<code title='Line 33, lib/parsing/step_hash.rb'><pre><a name='33'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/step_hash.rb#L33'> 33</a>         from_route_array << route[0] if route[1][:route].from_step_id == step.id
</pre></code><p>... we add the ID of the route to the array of inbound IDs, if the route is inbound to this step ...</p>
<code title='Line 36, lib/parsing/step_hash.rb'><pre><a name='36'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/step_hash.rb#L36'> 36</a>     		to_route_array << route[0] if route[1][:route].to_step_id == step.id
</pre></code><code title='Line 37, lib/parsing/step_hash.rb'><pre><a name='37'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/step_hash.rb#L37'> 37</a>     	end
</pre></code><p>... we add the array of outbound route IDs to the hash of outbound routes, keyed off the step ID ...</p>
<code title='Line 40, lib/parsing/step_hash.rb'><pre><a name='40'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/step_hash.rb#L40'> 40</a>       @routes_from_steps[step.id] = from_route_array
</pre></code><p>... we add the array of inbound route IDs to the hash of inbound routes, keyed off the step ID ...</p>
<code title='Line 43, lib/parsing/step_hash.rb'><pre><a name='43'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/step_hash.rb#L43'> 43</a>       @routes_to_steps[step.id] = to_route_array
</pre></code><p>... and we add the step object to the hash of steps, keyed off the step ID.</p>
<code title='Line 46, lib/parsing/step_hash.rb'><pre><a name='46'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/step_hash.rb#L46'> 46</a>       @steps[step.id] = step
</pre></code><code title='Line 47, lib/parsing/step_hash.rb'><pre><a name='47'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/step_hash.rb#L47'> 47</a>     end
</pre></code><code title='Line 48, lib/parsing/step_hash.rb'><pre><a name='48'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/step_hash.rb#L48'> 48</a>   end
</pre></code><h2>A set of methods to get attributes of the steps hash.</h2>
<p>We call all methods with the ID of the step.</p>
<h3>Method to get the step object from the steps hash.</h3>
<code title='Line 54, lib/parsing/step_hash.rb'><pre><a name='54'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/step_hash.rb#L54'> 54</a>   def step_object( step_id )
</pre></code><code title='Line 55, lib/parsing/step_hash.rb'><pre><a name='55'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/step_hash.rb#L55'> 55</a>     @steps[step_id]
</pre></code><code title='Line 56, lib/parsing/step_hash.rb'><pre><a name='56'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/step_hash.rb#L56'> 56</a>   end
</pre></code><h3>Method to get the name of a step from the steps hash.</h3>
<code title='Line 59, lib/parsing/step_hash.rb'><pre><a name='59'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/step_hash.rb#L59'> 59</a>   def step_name( step_id )
</pre></code><code title='Line 60, lib/parsing/step_hash.rb'><pre><a name='60'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/step_hash.rb#L60'> 60</a>     step_object( step_id )[:name]
</pre></code><code title='Line 61, lib/parsing/step_hash.rb'><pre><a name='61'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/step_hash.rb#L61'> 61</a>   end
</pre></code><p>========</p>
<h3>Method to check if a step has been actualised with a business item having a date in the past or of today.</h3>
<code title='Line 66, lib/parsing/step_hash.rb'><pre><a name='66'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/step_hash.rb#L66'> 66</a>   def step_has_been_actualised_has_happened?( step_id )
</pre></code><p>We assume the step has not been actualised with a business item having a date in the past or of today.</p>
<code title='Line 69, lib/parsing/step_hash.rb'><pre><a name='69'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/step_hash.rb#L69'> 69</a>     actualised_has_happened = false
</pre></code><p>We set the actualised_has_happened boolean to true if the step has been actualised in this work package, by at least one business item having a date in the past or of today.</p>
<code title='Line 72, lib/parsing/step_hash.rb'><pre><a name='72'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/step_hash.rb#L72'> 72</a>     actualised_has_happened = true if step_object( step_id ).is_actualised_has_happened
</pre></code><p>We return the boolean.</p>
<code title='Line 75, lib/parsing/step_hash.rb'><pre><a name='75'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/step_hash.rb#L75'> 75</a>     actualised_has_happened
</pre></code><code title='Line 76, lib/parsing/step_hash.rb'><pre><a name='76'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/step_hash.rb#L76'> 76</a>   end
</pre></code><p>======</p>
<h3>Method to get an array of IDs of inbound routes to a step.</h3>
<code title='Line 81, lib/parsing/step_hash.rb'><pre><a name='81'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/step_hash.rb#L81'> 81</a>   def step_inbound_routes( step_id )
</pre></code><code title='Line 82, lib/parsing/step_hash.rb'><pre><a name='82'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/step_hash.rb#L82'> 82</a>     @routes_to_steps[step_id]
</pre></code><code title='Line 83, lib/parsing/step_hash.rb'><pre><a name='83'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/step_hash.rb#L83'> 83</a>   end
</pre></code><h3>Method to get the ID of the first inbound route to a step.</h3>
<p>The appearance of inbound routes in first or second place has no meaning beyond the order they are delivered from the data store.</p>
<code title='Line 87, lib/parsing/step_hash.rb'><pre><a name='87'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/step_hash.rb#L87'> 87</a>   def step_first_inbound_route( step_id )
</pre></code><code title='Line 88, lib/parsing/step_hash.rb'><pre><a name='88'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/step_hash.rb#L88'> 88</a>     step_inbound_routes( step_id )[0]
</pre></code><code title='Line 89, lib/parsing/step_hash.rb'><pre><a name='89'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/step_hash.rb#L89'> 89</a>   end
</pre></code><h3>Method to get the ID of the second inbound route to a step.</h3>
<p>The appearance of inbound routes in first or second place has no meaning beyond the order they are delivered from the data store.</p>
<code title='Line 93, lib/parsing/step_hash.rb'><pre><a name='93'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/step_hash.rb#L93'> 93</a>   def step_second_inbound_route( step_id )
</pre></code><code title='Line 94, lib/parsing/step_hash.rb'><pre><a name='94'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/step_hash.rb#L94'> 94</a>     step_inbound_routes( step_id )[1]
</pre></code><code title='Line 95, lib/parsing/step_hash.rb'><pre><a name='95'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/step_hash.rb#L95'> 95</a>   end
</pre></code><h3>Method to get outbound routes from a step.</h3>
<code title='Line 98, lib/parsing/step_hash.rb'><pre><a name='98'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/step_hash.rb#L98'> 98</a>   def step_outbound_routes( step_id )
</pre></code><code title='Line 99, lib/parsing/step_hash.rb'><pre><a name='99'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/step_hash.rb#L99'> 99</a>     @routes_from_steps[step_id]
</pre></code><code title='Line 100, lib/parsing/step_hash.rb'><pre><a name='100'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/step_hash.rb#L100'> 100</a>   end
</pre></code><code title='Line 101, lib/parsing/step_hash.rb'><pre><a name='101'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/step_hash.rb#L101'> 101</a> end</pre></code></body></html>