<!DOCTYPE html>
<html lang="en-GB">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">
    <link rel="alternate" type="text/markdown" href="route_hash.rb.md">
    <style>
      body {
        max-width: 40rem;
        margin: auto;
        padding: 2rem 1rem;
        font-family: 'Helvetica Neue','Helvetica', system-ui;
        color: black;
        background-color: white;
      }
      p {line-height: 1.4;}
      code {
      line-height: 1.4;
      color:gray;
      }
      code pre {white-space: pre-wrap; word-break: break-word;}
      code:hover {color:black;}
      h1, h2 {font-weight:normal;}
      a {text-decoration:none;}
      a.githubline {color:gray;font-weight:bold;}
      @media (prefers-color-scheme: dark) {
body {color:white;background-color:black;}
a {text-decoration:underline;color:white;}
}
    </style>
    <title>lib/parsing/route_hash.rb</title>
  </head>
  <body><p><a href="/procedures/meta/comments">/procedures/meta/comments</a></p><h1>Module to initialise, create and update a hash of a hash of route attributes keyed off the ID of a route.</h1>
<code title='Line 2, lib/parsing/route_hash.rb'><pre><a name='2'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L2'> 2</a> module PARSE_ROUTE_HASH
</pre></code><h2>Method to initialise a hash of a hash of route attributes keyed off the ID of a route.</h2>
<p>We use this to store values that are generated from parsing and are not on the route model.</p>
<code title='Line 6, lib/parsing/route_hash.rb'><pre><a name='6'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L6'> 6</a>   def initialise_route_hash( work_package )
</pre></code><p>We get all routes which appear in the procedure the work package is subject to, together with the name and type of the source step of each route and the name and type of the target step of each route.</p>
<code title='Line 9, lib/parsing/route_hash.rb'><pre><a name='9'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L9'> 9</a>     routes = work_package.parliamentary_procedure.routes_with_steps
</pre></code><p>We record the number of routes in the procedure as an instance variable, so we can use it to report progress.</p>
<code title='Line 12, lib/parsing/route_hash.rb'><pre><a name='12'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L12'> 12</a>     @route_count = routes.size
</pre></code><p>If the procedure has no routes ...</p>
<code title='Line 15, lib/parsing/route_hash.rb'><pre><a name='15'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L15'> 15</a>     if routes.empty?
</pre></code><p>... we write to the log, explaining that the work package cannot be parsed.</p>
<code title='Line 18, lib/parsing/route_hash.rb'><pre><a name='18'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L18'> 18</a>       @parse_log << "Work package #{work_package.id} is subject to the #{work_package.parliamentary_procedure.name} procedure. This procedure has no routes and therefore the work package cannot be parsed."
</pre></code><p>Otherwise, if the procedure does have routes ...</p>
<code title='Line 21, lib/parsing/route_hash.rb'><pre><a name='21'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L21'> 21</a>     else
</pre></code><p>... we create a hash for the routes and their attributes.</p>
<p>This is created as an instance variable because we want to write to it as we parse and report on it later.</p>
<code title='Line 25, lib/parsing/route_hash.rb'><pre><a name='25'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L25'> 25</a>       @routes = {}
</pre></code><p>... we loop through the routes and ...</p>
<code title='Line 28, lib/parsing/route_hash.rb'><pre><a name='28'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L28'> 28</a>       routes.each do |route|
</pre></code><p>... for each route create a hash of values we want to store for that route.</p>
<code title='Line 31, lib/parsing/route_hash.rb'><pre><a name='31'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L31'> 31</a>         route_hash = create_and_add_route_hash(
</pre></code><code title='Line 32, lib/parsing/route_hash.rb'><pre><a name='32'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L32'> 32</a>           route, # We pass in the route which we'll use as the key of the hash.
</pre></code><code title='Line 33, lib/parsing/route_hash.rb'><pre><a name='33'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L33'> 33</a>           'NULL', # We pass in the current attribute to capture if the route is currently active. This is 'NULL' until the route is parsed.
</pre></code><code title='Line 34, lib/parsing/route_hash.rb'><pre><a name='34'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L34'> 34</a>           'UNPARSED', # We pass in the status attribute of the route. This is 'UNPARSED' until the route is parsed.
</pre></code><code title='Line 35, lib/parsing/route_hash.rb'><pre><a name='35'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L35'> 35</a>           false, # We pass in the parsed attribute of the route. This is false until the route is successfully parsed. A route may have many parse passes before being successfully parsed.
</pre></code><code title='Line 36, lib/parsing/route_hash.rb'><pre><a name='36'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L36'> 36</a>           0, # We pass in the actualised has happened count of the route. This is 0 until we parse a route whose source is a business step, at which point we set it to the count of actualisations of that step having business items with dates in the past or of today. This count may be processed by arithmetic steps being the target steps of subsequent routes.
</pre></code><code title='Line 37, lib/parsing/route_hash.rb'><pre><a name='37'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L37'> 37</a>           0, # We pass in the parse pass count attribute of this route. This is 0 until parsed.
</pre></code><code title='Line 38, lib/parsing/route_hash.rb'><pre><a name='38'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L38'> 38</a>         )
</pre></code><code title='Line 39, lib/parsing/route_hash.rb'><pre><a name='39'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L39'> 39</a>       end
</pre></code><code title='Line 40, lib/parsing/route_hash.rb'><pre><a name='40'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L40'> 40</a>     end
</pre></code><code title='Line 41, lib/parsing/route_hash.rb'><pre><a name='41'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L41'> 41</a>   end
</pre></code><h2>Method to create a hash of attributes for a route and to add the attributes hash to the containing routes hash.</h2>
<code title='Line 44, lib/parsing/route_hash.rb'><pre><a name='44'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L44'> 44</a>   def create_and_add_route_hash( route, current, status, parsed, actualisation_count, parse_pass_count )
</pre></code><p>We create a hash of route attributes.</p>
<code title='Line 47, lib/parsing/route_hash.rb'><pre><a name='47'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L47'> 47</a>     route_hash = {
</pre></code><code title='Line 48, lib/parsing/route_hash.rb'><pre><a name='48'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L48'> 48</a>       :current => current,
</pre></code><code title='Line 49, lib/parsing/route_hash.rb'><pre><a name='49'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L49'> 49</a>       :status => status,
</pre></code><code title='Line 50, lib/parsing/route_hash.rb'><pre><a name='50'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L50'> 50</a>       :parsed => parsed,
</pre></code><code title='Line 51, lib/parsing/route_hash.rb'><pre><a name='51'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L51'> 51</a>       :actualisation_count => actualisation_count,
</pre></code><code title='Line 52, lib/parsing/route_hash.rb'><pre><a name='52'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L52'> 52</a>       :parse_pass_count => parse_pass_count,
</pre></code><code title='Line 53, lib/parsing/route_hash.rb'><pre><a name='53'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L53'> 53</a>       :route => route
</pre></code><code title='Line 54, lib/parsing/route_hash.rb'><pre><a name='54'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L54'> 54</a>     }
</pre></code><p>We add the hash to the routes hash, keyed off the ID of the route.</p>
<code title='Line 57, lib/parsing/route_hash.rb'><pre><a name='57'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L57'> 57</a>     @routes[route.id] = route_hash
</pre></code><code title='Line 58, lib/parsing/route_hash.rb'><pre><a name='58'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L58'> 58</a>   end
</pre></code><h2>Method to update the hash of attributes for a route within the containing route hash.</h2>
<code title='Line 61, lib/parsing/route_hash.rb'><pre><a name='61'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L61'> 61</a>   def update_route_hash( route_id, current, status, parsed, actualisation_count, parse_pass_count )
</pre></code><p>We check if this method has been passed a value for an attribute.</p>
<p>Where the method has been passed nil as an attribute value, we use the attribute value as it exists in the hash.</p>
<code title='Line 65, lib/parsing/route_hash.rb'><pre><a name='65'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L65'> 65</a>     current = current || @routes[route_id][:current]
</pre></code><code title='Line 66, lib/parsing/route_hash.rb'><pre><a name='66'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L66'> 66</a>     status = status || @routes[route_id][:status]
</pre></code><code title='Line 67, lib/parsing/route_hash.rb'><pre><a name='67'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L67'> 67</a>     parsed = parsed || @routes[route_id][:parsed]
</pre></code><code title='Line 68, lib/parsing/route_hash.rb'><pre><a name='68'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L68'> 68</a>     actualisation_count = actualisation_count || @routes[route_id][:actualisation_count]
</pre></code><code title='Line 69, lib/parsing/route_hash.rb'><pre><a name='69'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L69'> 69</a>     parse_pass_count = parse_pass_count || @routes[route_id][:parse_pass_count]
</pre></code><p>We create a hash of attributes for the route with any revised values.</p>
<code title='Line 72, lib/parsing/route_hash.rb'><pre><a name='72'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L72'> 72</a>     route_hash = {
</pre></code><code title='Line 73, lib/parsing/route_hash.rb'><pre><a name='73'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L73'> 73</a>       :current => current,
</pre></code><code title='Line 74, lib/parsing/route_hash.rb'><pre><a name='74'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L74'> 74</a>       :status => status,
</pre></code><code title='Line 75, lib/parsing/route_hash.rb'><pre><a name='75'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L75'> 75</a>       :parsed => parsed,
</pre></code><code title='Line 76, lib/parsing/route_hash.rb'><pre><a name='76'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L76'> 76</a>       :actualisation_count => actualisation_count,
</pre></code><code title='Line 77, lib/parsing/route_hash.rb'><pre><a name='77'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L77'> 77</a>       :parse_pass_count => parse_pass_count,
</pre></code><code title='Line 78, lib/parsing/route_hash.rb'><pre><a name='78'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L78'> 78</a>       :route => @routes[route_id][:route]
</pre></code><code title='Line 79, lib/parsing/route_hash.rb'><pre><a name='79'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L79'> 79</a>     }
</pre></code><p>We push this back into the hash of routes, keyed off the ID of the route.</p>
<code title='Line 82, lib/parsing/route_hash.rb'><pre><a name='82'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L82'> 82</a>     @routes[route_id] = route_hash
</pre></code><code title='Line 83, lib/parsing/route_hash.rb'><pre><a name='83'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L83'> 83</a>   end
</pre></code><h2>A set of methods to get attributes of a route.</h2>
<p>We call all methods with the ID of the route.</p>
<h3>Method to get the hash of route attributes from the routes hash.</h3>
<code title='Line 89, lib/parsing/route_hash.rb'><pre><a name='89'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L89'> 89</a>   def route_hash( route_id )
</pre></code><code title='Line 90, lib/parsing/route_hash.rb'><pre><a name='90'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L90'> 90</a>     @routes[route_id]
</pre></code><code title='Line 91, lib/parsing/route_hash.rb'><pre><a name='91'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L91'> 91</a>   end
</pre></code><h3>Method to get the current attribute of the route hash.</h3>
<code title='Line 94, lib/parsing/route_hash.rb'><pre><a name='94'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L94'> 94</a>   def route_current_attribute( route_id )
</pre></code><code title='Line 95, lib/parsing/route_hash.rb'><pre><a name='95'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L95'> 95</a>     route_hash( route_id )[:current]
</pre></code><code title='Line 96, lib/parsing/route_hash.rb'><pre><a name='96'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L96'> 96</a>   end
</pre></code><h3>Method to get the status attribute of the route hash.</h3>
<code title='Line 99, lib/parsing/route_hash.rb'><pre><a name='99'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L99'> 99</a>   def route_status_attribute( route_id )
</pre></code><code title='Line 100, lib/parsing/route_hash.rb'><pre><a name='100'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L100'> 100</a>     route_hash( route_id )[:status]
</pre></code><code title='Line 101, lib/parsing/route_hash.rb'><pre><a name='101'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L101'> 101</a>   end
</pre></code><h3>Method to check if the untraversable attribute of the route is set to untraversable.</h3>
<code title='Line 104, lib/parsing/route_hash.rb'><pre><a name='104'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L104'> 104</a>   def route_is_untraversable?( route_id )
</pre></code><p>We assume the route is traversable.</p>
<code title='Line 107, lib/parsing/route_hash.rb'><pre><a name='107'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L107'> 107</a>     untraversable = false
</pre></code><p>We set the value of untraversable to true if the routes hash has a status of ‘UNTRAVERSABLE’ for the route with this ID.</p>
<code title='Line 110, lib/parsing/route_hash.rb'><pre><a name='110'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L110'> 110</a>     untraversable = true if route_status_attribute( route_id ) == 'UNTRAVERSABLE'
</pre></code><p>We return the boolean.</p>
<code title='Line 113, lib/parsing/route_hash.rb'><pre><a name='113'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L113'> 113</a>     untraversable
</pre></code><code title='Line 114, lib/parsing/route_hash.rb'><pre><a name='114'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L114'> 114</a>   end
</pre></code><h3>Method to get the parsed attribute of the route hash.</h3>
<code title='Line 117, lib/parsing/route_hash.rb'><pre><a name='117'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L117'> 117</a>   def route_parsed_attribute( route_id )
</pre></code><code title='Line 118, lib/parsing/route_hash.rb'><pre><a name='118'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L118'> 118</a>     route_hash( route_id )[:parsed]
</pre></code><code title='Line 119, lib/parsing/route_hash.rb'><pre><a name='119'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L119'> 119</a>   end
</pre></code><h3>Method to get the parse pass count attribute of the route hash.</h3>
<code title='Line 122, lib/parsing/route_hash.rb'><pre><a name='122'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L122'> 122</a>   def route_parse_pass_count_attribute( route_id )
</pre></code><code title='Line 123, lib/parsing/route_hash.rb'><pre><a name='123'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L123'> 123</a>     route_hash( route_id )[:parse_pass_count]
</pre></code><code title='Line 124, lib/parsing/route_hash.rb'><pre><a name='124'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L124'> 124</a>   end
</pre></code><h3>Method to get the route object from the routes hash.</h3>
<code title='Line 127, lib/parsing/route_hash.rb'><pre><a name='127'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L127'> 127</a>   def route_object( route_id )
</pre></code><code title='Line 128, lib/parsing/route_hash.rb'><pre><a name='128'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L128'> 128</a>     route_hash( route_id )[:route]
</pre></code><code title='Line 129, lib/parsing/route_hash.rb'><pre><a name='129'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L129'> 129</a>   end
</pre></code><h3>Method to check if a route is current.</h3>
<code title='Line 132, lib/parsing/route_hash.rb'><pre><a name='132'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L132'> 132</a>   def route_is_current?( route_id )
</pre></code><p>A route may have start and end dates.</p>
<p>We get the start and end dates from the route object.</p>
<code title='Line 136, lib/parsing/route_hash.rb'><pre><a name='136'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L136'> 136</a>     start_date = route_object( route_id ).start_date
</pre></code><code title='Line 137, lib/parsing/route_hash.rb'><pre><a name='137'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L137'> 137</a>     end_date = route_object( route_id ).end_date
</pre></code><p>If the route has a start date and the start date is in the future, being after today ...</p>
<code title='Line 140, lib/parsing/route_hash.rb'><pre><a name='140'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L140'> 140</a>     if start_date and start_date > Date.today
</pre></code><p>.. we set current to false because the road is not yet open.</p>
<code title='Line 143, lib/parsing/route_hash.rb'><pre><a name='143'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L143'> 143</a>       current = false
</pre></code><p>Otherwise, if the route has an end date and the end date is in the past, being earlier than today ...</p>
<code title='Line 146, lib/parsing/route_hash.rb'><pre><a name='146'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L146'> 146</a>     elsif end_date and end_date < Date.today
</pre></code><p>... we set current to false because the road closed in the past.</p>
<code title='Line 149, lib/parsing/route_hash.rb'><pre><a name='149'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L149'> 149</a>       current = false
</pre></code><p>Otherwise, if the route has no start date or a start date in the past or no end date or an end date in the future ...</p>
<code title='Line 152, lib/parsing/route_hash.rb'><pre><a name='152'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L152'> 152</a>     else
</pre></code><p>... we set current to true because the road is open.</p>
<code title='Line 155, lib/parsing/route_hash.rb'><pre><a name='155'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L155'> 155</a>       current = true
</pre></code><code title='Line 156, lib/parsing/route_hash.rb'><pre><a name='156'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L156'> 156</a>     end
</pre></code><p>We return the value we&#39;ve set for the route&#39;s currency.</p>
<code title='Line 159, lib/parsing/route_hash.rb'><pre><a name='159'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L159'> 159</a>     current
</pre></code><code title='Line 160, lib/parsing/route_hash.rb'><pre><a name='160'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L160'> 160</a>   end
</pre></code><h3>Method to get the ID of the source step of a route.</h3>
<code title='Line 163, lib/parsing/route_hash.rb'><pre><a name='163'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L163'> 163</a>   def route_source_step_id( route_id )
</pre></code><p>We get the from_step_id of the route in the routes hash with this ID.</p>
<code title='Line 166, lib/parsing/route_hash.rb'><pre><a name='166'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L166'> 166</a>     route_object( route_id ).from_step_id
</pre></code><code title='Line 167, lib/parsing/route_hash.rb'><pre><a name='167'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L167'> 167</a>   end
</pre></code><h3>Method to get the name of the source step of a route.</h3>
<code title='Line 170, lib/parsing/route_hash.rb'><pre><a name='170'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L170'> 170</a>   def route_source_step_name( route_id )
</pre></code><p>We get the name of the source step of the route in the routes hash with this ID.</p>
<code title='Line 173, lib/parsing/route_hash.rb'><pre><a name='173'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L173'> 173</a>     route_object( route_id ).source_step_name
</pre></code><code title='Line 174, lib/parsing/route_hash.rb'><pre><a name='174'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L174'> 174</a>   end
</pre></code><h3>Method to get the name of the type of the source step of a route.</h3>
<code title='Line 177, lib/parsing/route_hash.rb'><pre><a name='177'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L177'> 177</a>   def route_source_step_type( route_id )
</pre></code><p>We get the name of the source step of the route in the routes hash with this ID.</p>
<code title='Line 180, lib/parsing/route_hash.rb'><pre><a name='180'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L180'> 180</a>     route_object( route_id ).source_step_type
</pre></code><code title='Line 181, lib/parsing/route_hash.rb'><pre><a name='181'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L181'> 181</a>   end
</pre></code><h3>Method to get the source step object of a route.</h3>
<code title='Line 184, lib/parsing/route_hash.rb'><pre><a name='184'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L184'> 184</a>   def route_source_step( route_id )
</pre></code><p>We get the step object with the ID of the source step of the route.</p>
<code title='Line 187, lib/parsing/route_hash.rb'><pre><a name='187'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L187'> 187</a>     @steps[route_source_step_id( route_id )]
</pre></code><code title='Line 188, lib/parsing/route_hash.rb'><pre><a name='188'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L188'> 188</a>   end
</pre></code><h3>Method to get the ID of the target step of a route.</h3>
<code title='Line 191, lib/parsing/route_hash.rb'><pre><a name='191'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L191'> 191</a>   def route_target_step_id( route_id )
</pre></code><p>We get the to_step_id of the route in the routes hash with this ID.</p>
<code title='Line 194, lib/parsing/route_hash.rb'><pre><a name='194'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L194'> 194</a>     route_object( route_id ).to_step_id
</pre></code><code title='Line 195, lib/parsing/route_hash.rb'><pre><a name='195'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L195'> 195</a>   end
</pre></code><h3>Method to get the name of the target step of a route.</h3>
<code title='Line 198, lib/parsing/route_hash.rb'><pre><a name='198'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L198'> 198</a>   def route_target_step_name( route_id )
</pre></code><p>We get the name of the target step of the route in the routes hash with this ID.</p>
<code title='Line 201, lib/parsing/route_hash.rb'><pre><a name='201'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L201'> 201</a>     route_object( route_id ).target_step_name
</pre></code><code title='Line 202, lib/parsing/route_hash.rb'><pre><a name='202'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L202'> 202</a>   end
</pre></code><h3>Method to get the name of the type of the target step of a route.</h3>
<code title='Line 205, lib/parsing/route_hash.rb'><pre><a name='205'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L205'> 205</a>   def route_target_step_type( route_id )
</pre></code><p>We get the name of the target step of the route in the routes hash with this ID.</p>
<code title='Line 208, lib/parsing/route_hash.rb'><pre><a name='208'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L208'> 208</a>     route_object( route_id ).target_step_type
</pre></code><code title='Line 209, lib/parsing/route_hash.rb'><pre><a name='209'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L209'> 209</a>   end
</pre></code><h3>Method to get the target step object of a route.</h3>
<code title='Line 212, lib/parsing/route_hash.rb'><pre><a name='212'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L212'> 212</a>   def route_target_step( route_id )
</pre></code><p>We get the step object with the ID of the target step of the route.</p>
<code title='Line 215, lib/parsing/route_hash.rb'><pre><a name='215'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L215'> 215</a>     @steps[route_target_step_id( route_id )]
</pre></code><code title='Line 216, lib/parsing/route_hash.rb'><pre><a name='216'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L216'> 216</a>   end
</pre></code><h3>Method to check if the target step of a route is actualised by a business item, regardless of the date of that business item.</h3>
<code title='Line 219, lib/parsing/route_hash.rb'><pre><a name='219'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L219'> 219</a>   def route_target_step_is_actualised?( route_id )
</pre></code><p>We check if the target step of the route has been actualised.</p>
<code title='Line 222, lib/parsing/route_hash.rb'><pre><a name='222'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L222'> 222</a>     step_has_been_actualised?( route_target_step( route_id ) )
</pre></code><code title='Line 223, lib/parsing/route_hash.rb'><pre><a name='223'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L223'> 223</a>   end
</pre></code><h3>Method to get the actualised as happened_count from the source step of a route.</h3>
<code title='Line 226, lib/parsing/route_hash.rb'><pre><a name='226'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L226'> 226</a>   def route_source_step_actualised_has_happened_count( route_id )
</pre></code><p>We get the actualised as happened count from the source step.</p>
<code title='Line 229, lib/parsing/route_hash.rb'><pre><a name='229'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L229'> 229</a>     step_actualised_as_happened_count( route_source_step_id( route_id ) )
</pre></code><code title='Line 230, lib/parsing/route_hash.rb'><pre><a name='230'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L230'> 230</a>   end
</pre></code><h3>Method to get the actualisation count of a route.</h3>
<code title='Line 233, lib/parsing/route_hash.rb'><pre><a name='233'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L233'> 233</a>   def route_actualisation_count( route_id )
</pre></code><p>We get the actualisation count of the route in the routes hash with this ID.</p>
<code title='Line 236, lib/parsing/route_hash.rb'><pre><a name='236'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L236'> 236</a>     route_object( route_id ).actualisation_count
</pre></code><code title='Line 237, lib/parsing/route_hash.rb'><pre><a name='237'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L237'> 237</a>   end
</pre></code><code title='Line 238, lib/parsing/route_hash.rb'><pre><a name='238'  class='githubline' href='https://github.com/ukparliament/procedure-parsing/tree/master/lib/parsing/route_hash.rb#L238'> 238</a> end</pre></code></body></html>